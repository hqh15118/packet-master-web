(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7748f080"],{"0f09":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{staticClass:"box-card"},[i("sticky",{attrs:{"z-index":10,"class-name":"sub-navbar"}},[i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success"},on:{click:t.submitForm}},[t._v("\n      提交"),i("i",{staticClass:"el-icon-upload el-icon--right"})])],1),t._v(" "),i("h1",{staticStyle:{margin:"20px"}},[t._v(t._s(t.deviceName))]),t._v(" "),i("div",{staticStyle:{margin:"20px"}},[i("h3",{staticStyle:{"margin-bottom":"20px"}},[t._v("开放端口：")]),t._v(" "),t._l(t.portTags,function(e){return i("el-tag",{key:e,staticClass:"tagClass",attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handlePortClose(e)}}},[t._v("\n      "+t._s(e)+"\n    ")])}),t._v(" "),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 端口")])],2),t._v(" "),i("el-divider"),t._v(" "),i("div",{staticStyle:{margin:"20px"}},[i("h3",{staticStyle:{"margin-bottom":"20px"}},[t._v("信任设备：")]),t._v(" "),t._l(t.devicesTags,function(e){return i("el-tag",{key:e.value,staticClass:"tagClass",attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleClose(e)},click:function(i){return t.handleClick(e)}}},[t._v("\n      "+t._s(e.label)+"\n    ")])}),t._v(" "),t.selectVisible?i("el-select",{ref:"saveTagSelect",attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择设备"},on:{change:t.handleSelectChange},model:{value:t.tagValue,callback:function(e){t.tagValue=e},expression:"tagValue"}},t._l(t.deviceList,function(e){return i("el-option",{key:e.deviceTag,attrs:{label:e.deviceInfo,value:e.deviceTag}},[i("span",{staticStyle:{float:"left"}},[t._v(t._s(e.deviceInfo))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.deviceTag))])])}),1):i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showSelect}},[t._v("+ 设 备")])],2),t._v(" "),i("el-divider"),t._v(" "),t.cascaderVisible?i("div",{staticStyle:{margin:"20px"}},[i("h3",{staticStyle:{"margin-bottom":"20px"}},[t._v("操作指令：")]),t._v(" "),i("el-cascader-panel",{staticClass:"cascader",attrs:{options:t.codeOptions,props:t.props},on:{change:t.panelChange},model:{value:t.chooseList,callback:function(e){t.chooseList=e},expression:"chooseList"}})],1):t._e(),t._v(" "),i("div",{staticStyle:{margin:"20px"}},[i("h3",{staticStyle:{"margin-bottom":"20px"}},[t._v("策略展示：")]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"","span-method":t.objectSpanMethod}},[i("el-table-column",{attrs:{type:"index",align:"center",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"源设备"}},[i("el-table-column",{attrs:{label:"名称",align:"center",prop:"srcDevice"}}),t._v(" "),i("el-table-column",{attrs:{label:"源IP",align:"center",prop:"srcIp"}}),t._v(" "),i("el-table-column",{attrs:{label:"源MAC",align:"center",prop:"srcMac"}})],1),t._v(" "),i("el-table-column",{attrs:{label:"目的设备",align:"center",prop:"dstDevice"}}),t._v(" "),i("el-table-column",{attrs:{label:"协议类型",align:"center",prop:"protocol"}}),t._v(" "),i("el-table-column",{attrs:{label:"功能码",align:"center",prop:"funcodes"}})],1)],1)],1)},s=[],a=(i("20d6"),i("ac6a"),i("7514"),i("aa98")),o=i("34c6"),c=i("de90"),r=i("b804"),l={components:{Sticky:r["a"]},data:function(){return{inputVisible:!1,inputValue:"",portTags:[],deviceAddr:"",deviceNumber:"",deviceID:0,deviceName:"",selectVisible:!1,cascaderVisible:!1,deviceList:[],tagValue:"",props:{multiple:!0},codeOptions:[],devicesTags:[],chooseList:[],panelData:[],chooseTag:0,tableData:[],arr:[],protocolList:[]}},created:function(){this.deviceNumber=this.$route.params.number,this.getList(),this.loadFuncode(),this.getConfigedProtocol()},mounted:function(){},methods:{getConfigedProtocol:function(){var t=this;this.listLoading=!0,Object(c["d"])(this.deviceNumber).then(function(e){for(var i=e.data,n="",s=function(e){var s=i[e];n!==s.fvDimensionFilter.srcMac&&n!==s.fvDimensionFilter.srcIp?(n=""===s.fvDimensionFilter.srcIp?s.fvDimensionFilter.srcMac:s.fvDimensionFilter.srcIp,o=t.deviceList.find(function(t){return t.deviceTag===n}),t.devicesTags.push({value:o.deviceTag,label:o.deviceInfo}),t.panelData.push([]),s.funCodes.forEach(function(e){t.panelData[t.panelData.length-1].push([s.fvDimensionFilter.protocolId,e])})):s.funCodes.forEach(function(e){t.panelData[t.panelData.length-1].push([s.fvDimensionFilter.protocolId,e])})},a=0;a<i.length;a++){var o;s(a)}t.showTable(i)}),this.listLoading=!1},showTable:function(t){var e=this;this.$nextTick(function(i){for(var n=0;n<e.devicesTags.length;n++)for(var s=e.devicesTags[n].value,a=0;a<t.length;a++){var o=t[a].fvDimensionFilter;if(s===o.srcIp||s===o.srcMac){var c=e.protocolList.find(function(t){return t.protocolId===o.protocolId});e.tableData.push({srcDevice:e.devicesTags[n].value,srcIp:o.srcIp,srcMac:o.srcMac,dstDevice:e.deviceName,protocol:c.protocolName,funcodes:o.opts})}}e.setTable(e.tableData,"dstDevice")})},getList:function(){var t=this,e=this.$store.getters.gplotId;this.listLoading=!0,0===e?(this.dataSource=[],this.listLoading=!1):(Object(a["c"])(e).then(function(e){t.deviceList=e.data;var i=t.deviceList.find(function(e){return e.deviceNumber===t.deviceNumber});t.deviceID=i.device_id,t.deviceAddr=i.deviceTag,t.deviceName=i.deviceInfo+":"+t.deviceAddr,t.deviceList.splice(t.deviceList.findIndex(function(e){return e.deviceNumber===t.deviceNumber}),1)}),this.listLoading=!1)},loadFuncode:function(){var t=this;Object(o["f"])().then(function(e){var i=e.data;t.protocolList=i,i.forEach(function(e){var i={value:e.protocolId,label:e.protocolName,children:[]};Object(o["e"])({page:1,limit:999,protocolId:e.protocolId,codeDes:""}).then(function(e){var n=e.data.configurationWrappers;n.length>0&&(n.forEach(function(t){i.children.push({value:t.funCode,label:t.opt})}),t.codeOptions.push(i))})})})},isNotInList:function(t){return this.deviceList.every(function(e){return t!==e.deviceTag})},handleClick:function(t){this.cascaderVisible=!0,this.chooseTag=this.devicesTags.indexOf(t),this.chooseList=this.panelData[this.chooseTag]},handleClose:function(t){var e=this.devicesTags.indexOf(t);this.devicesTags.splice(e,1),this.panelData.splice(e,1)},showSelect:function(){var t=this;this.selectVisible=!0,this.$nextTick(function(e){t.$refs.saveTagSelect.focus()})},handleSelectChange:function(t){var e=this.tagValue;if(e)if(this.isNotInList(e)){var i=/[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}:[A-Fa-f0-9]{2}/.test(e),n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e);i||n?(this.devicesTags.push({value:e,label:e}),this.panelData.push([])):this.$message.error("请输入正确的设备地址。")}else{var s=this.deviceList.find(function(t){return t.deviceTag===e});this.devicesTags.push({value:s.deviceTag,label:s.deviceInfo}),this.panelData.push([])}this.selectVisible=!1,this.tagValue=""},panelChange:function(t){this.panelData[this.chooseTag]=t},submitForm:function(){for(var t=this,e=[],i=0;i<this.devicesTags.length;i++){var n={fvDimensionFilter:{deviceNumber:this.deviceNumber,id:0,srcMac:"",dstMac:"",srcIp:"",dstIp:"",protocolId:void 0,srcPort:"",dstPort:"",filterType:0,userName:"admin",fvId:"",gplotId:this.$store.getters.gplotId,opts:""},funCodes:[],dstPorts:[1,2,3,4,5,6]},s=this.devicesTags[i],a=this.panelData[i];17===s.value.length?n.fvDimensionFilter.srcMac=s.value:n.fvDimensionFilter.srcIp=s.value,17===this.deviceAddr.length?n.fvDimensionFilter.dstMac=this.deviceAddr:n.fvDimensionFilter.dstIp=this.deviceAddr;var o=-1,r=[],l={protocol:0,funcodes:[]};a.forEach(function(t){o!==t[0]?(l={protocol:t[0],funcodes:[t[1]]},r.push(l),o=t[0]):r[r.length-1].funcodes.push(t[1])}),r.forEach(function(t){var i=Object.assign({},n);i.fvDimensionFilter.protocolId=t.protocol,i.funCodes=t.funcodes,e.push(i)})}Object(c["f"])(e).then(function(e){t.$notify({message:"策略配置成功",type:"success",duration:2e3})}).catch(function(e){t.$message.error(e)})},handlePortClose:function(t){this.portTags.splice(this.portTags.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.inputValue;t&&this.portTags.push(t),this.inputVisible=!1,this.inputValue=""},setTable:function(t,e){var i=[],n=0;t.forEach(function(s,a){0===a?i.push(1):s[e]&&s[e]===t[a-1][e]?(i[n]+=1,i.push(0)):(i.push(1),n=a)});var s={};s[e]=i,this.arr.push(s),console.log(this.arr)},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,i=t.columnIndex;if(4===i){var n=this.arr[0].dstDevice[e],s=n>0?1:0;return{rowspan:n,colspan:s}}}}},d=l,u=(i("1b6e"),i("13ee"),i("2877")),h=Object(u["a"])(d,n,s,!1,null,null,null);e["default"]=h.exports},"13ee":function(t,e,i){"use strict";var n=i("b85d"),s=i.n(n);s.a},"1b6e":function(t,e,i){"use strict";var n=i("9248"),s=i.n(n);s.a},"34c6":function(t,e,i){"use strict";i.d(e,"f",function(){return s}),i.d(e,"e",function(){return a}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return c}),i.d(e,"b",function(){return r}),i.d(e,"d",function(){return l});var n=i("b775");function s(){return Object(n["a"])({url:"/rule/protocol_list",method:"get"})}function a(t){return Object(n["a"])({url:"/rule/funcode_list",method:"post",data:t})}function o(t){return Object(n["a"])({url:"/rule/new_funcode",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/rule/deletecode",method:"delete",data:t})}function r(t){return Object(n["a"])({url:"/rule/new_protocol",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/rule/delete_protocol",method:"delete",params:{protocolId:t}})}},7514:function(t,e,i){"use strict";var n=i("5ca1"),s=i("0a49")(5),a="find",o=!0;a in[]&&Array(1)[a](function(){o=!1}),n(n.P+n.F*o,"Array",{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(a)},9248:function(t,e,i){},b804:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:{height:t.height+"px",zIndex:t.zIndex}},[i("div",{class:t.className,style:{top:t.isSticky?t.stickyTop+"px":"",zIndex:t.zIndex,position:t.position,width:t.width,height:t.height+"px"}},[t._t("default",[i("div",[t._v("sticky")])])],2)])},s=[],a=(i("c5f6"),{name:"Sticky",props:{stickyTop:{type:Number,default:0},zIndex:{type:Number,default:1},className:{type:String,default:""}},data:function(){return{active:!1,position:"",width:void 0,height:void 0,isSticky:!1}},mounted:function(){this.height=this.$el.getBoundingClientRect().height,window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize)},activated:function(){this.handleScroll()},destroyed:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)},methods:{sticky:function(){this.active||(this.position="fixed",this.active=!0,this.width=this.width+"px",this.isSticky=!0)},handleReset:function(){this.active&&this.reset()},reset:function(){this.position="",this.width="auto",this.active=!1,this.isSticky=!1},handleScroll:function(){var t=this.$el.getBoundingClientRect().width;this.width=t||"auto";var e=this.$el.getBoundingClientRect().top;e<this.stickyTop?this.sticky():this.handleReset()},handleResize:function(){this.isSticky&&(this.width=this.$el.getBoundingClientRect().width+"px")}}}),o=a,c=i("2877"),r=Object(c["a"])(o,n,s,!1,null,null,null);e["a"]=r.exports},b85d:function(t,e,i){},de90:function(t,e,i){"use strict";i.d(e,"d",function(){return s}),i.d(e,"f",function(){return a}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return c}),i.d(e,"e",function(){return r}),i.d(e,"b",function(){return l});var n=i("b775");function s(t){return Object(n["a"])({url:"/gen/fv_dimension_filter/get_fv_packet_rule",method:"get",params:{deviceNumber:t}})}function a(t){return Object(n["a"])({url:"/gen/fv_dimension_filter/new_rule",method:"post",data:t})}function o(t){return Object(n["a"])({url:"/white_protocol/add_rp",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/white_protocol/del_rp",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/white_protocol/find_all_rp",method:"get",params:{deviceId:t}})}function l(t){return Object(n["a"])({url:"/attack/set_right_packet",method:"post",data:t})}}}]);